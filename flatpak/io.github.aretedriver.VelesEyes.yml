app-id: io.github.aretedriver.VelesEyes
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: veles-eyes

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=dri
  - --talk-name=org.freedesktop.Notifications
  - --filesystem=home:ro
  - --filesystem=~/.eve:rw
  - --filesystem=~/.config/eve-veles-eyes:create
  - --filesystem=~/.local/share/eve-veles-eyes:create

modules:
  - name: wmctrl
    buildsystem: autotools
    sources:
      - type: git
        url: https://github.com/Conservatory/wmctrl.git
        tag: v1.07

  - name: xdotool
    buildsystem: simple
    build-commands:
      - make PREFIX=/app install
    sources:
      - type: archive
        url: https://github.com/jordansissel/xdotool/releases/download/v3.20211022.1/xdotool-3.20211022.1.tar.gz
        sha256: 96f0facfde6d78eacad35b91b0f46fecd0b35e474c03e00e30da3f0bc0b3e3d2

  - name: python3-pyside6
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app PySide6==6.6.1
    sources: []

  - name: python3-deps
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app python-xlib pillow pynput numpy watchdog
    sources: []

  - name: eve-veles-eyes
    buildsystem: simple
    build-commands:
      - mkdir -p /app/share/eve-veles-eyes
      - cp -r src/* /app/share/eve-veles-eyes/
      - cp -r assets /app/share/eve-veles-eyes/ || mkdir /app/share/eve-veles-eyes/assets
      - |
        cat > /app/bin/veles-eyes << 'EOF'
        #!/bin/bash
        export PYTHONPATH=/app/share/eve-veles-eyes:$PYTHONPATH
        exec python3 /app/share/eve-veles-eyes/main.py "$@"
        EOF
      - chmod +x /app/bin/veles-eyes
      - install -Dm644 flatpak/io.github.aretedriver.VelesEyes.desktop /app/share/applications/io.github.aretedriver.VelesEyes.desktop
      - install -Dm644 assets/icon.png /app/share/icons/hicolor/256x256/apps/io.github.aretedriver.VelesEyes.png
      - install -Dm644 flatpak/io.github.aretedriver.VelesEyes.metainfo.xml /app/share/metainfo/io.github.aretedriver.VelesEyes.metainfo.xml
    sources:
      - type: dir
        path: ..
